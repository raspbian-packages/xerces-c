Description: Fix CVE-2016-2099
Origin: upstream, https://issues.apache.org/jira/browse/XERCESC-2066
Last-Update: 2016-5-10
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/

Index: xerces-c-3.1.1/src/xercesc/validators/DTD/DTDScanner.cpp
===================================================================
--- xerces-c-3.1.1.orig/src/xercesc/validators/DTD/DTDScanner.cpp	2016-05-12 10:01:09.000000000 +0200
+++ xerces-c-3.1.1/src/xercesc/validators/DTD/DTDScanner.cpp	2016-05-12 10:01:09.000000000 +0200
@@ -2509,7 +2509,15 @@
         {
             while (true)
             {
-                const XMLCh nextCh = fReaderMgr->peekNextChar();
+                XMLCh nextCh;
+
+                try {
+                    nextCh = fReaderMgr->peekNextChar();
+                }
+                catch (XMLException& ex) {
+                    fScanner->emitError(XMLErrs::XMLException_Fatal, ex.getCode(), ex.getMessage(), NULL, NULL);
+                    nextCh = chNull;
+                }
 
                 if (!nextCh)
                 {
