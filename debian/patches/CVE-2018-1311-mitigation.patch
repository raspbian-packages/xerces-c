Origin: http://vault.centos.org/7.7.1908/updates/Source/SPackages/xerces-c-3.1.1-10.el7_7.src.rpm
Origin: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=947431
Last-Update: 2020-12-16
Reviewed-by: Sylvain Beucler <beuc@debian.org>

https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2018-1311

Index: xerces-c-3.1.4+debian/src/xercesc/internal/IGXMLScanner.cpp
===================================================================
--- xerces-c-3.1.4+debian.orig/src/xercesc/internal/IGXMLScanner.cpp
+++ xerces-c-3.1.4+debian/src/xercesc/internal/IGXMLScanner.cpp
@@ -1532,7 +1532,6 @@ void IGXMLScanner::scanDocTypeDecl()
             DTDEntityDecl* declDTD = new (fMemoryManager) DTDEntityDecl(gDTDStr, false, fMemoryManager);
             declDTD->setSystemId(sysId);
             declDTD->setIsExternal(true);
-            Janitor<DTDEntityDecl> janDecl(declDTD);
 
             // Mark this one as a throw at end
             reader->setThrowAtEnd(true);
@@ -3095,7 +3094,6 @@ Grammar* IGXMLScanner::loadDTDGrammar(co
     DTDEntityDecl* declDTD = new (fMemoryManager) DTDEntityDecl(gDTDStr, false, fMemoryManager);
     declDTD->setSystemId(src.getSystemId());
     declDTD->setIsExternal(true);
-    Janitor<DTDEntityDecl> janDecl(declDTD);
 
     // Mark this one as a throw at end
     newReader->setThrowAtEnd(true);
Index: xerces-c-3.1.4+debian/scripts/sanityTest_ExpectedResult.log
===================================================================
--- xerces-c-3.1.4+debian.orig/scripts/sanityTest_ExpectedResult.log
+++ xerces-c-3.1.4+debian/scripts/sanityTest_ExpectedResult.log
@@ -1202,9 +1202,9 @@ Options:
 
   * = Default if not provided explicitly.
 
-At destruction, domBuilderMemMonitor has 0 bytes.
-At destruction, sax2MemMonitor has 0 bytes.
-At destruction, sax1MemMonitor has 0 bytes.
+At destruction, domBuilderMemMonitor has 276 bytes.
+At destruction, sax2MemMonitor has 276 bytes.
+At destruction, sax1MemMonitor has 276 bytes.
 At destruction, staticMemMonitor has 0 bytes.
 At destruction, domBuilderMemMonitor has 0 bytes.
 At destruction, sax2MemMonitor has 0 bytes.
Index: xerces-c-3.1.4+debian/scripts/sanityTest_ExpectedResult_32.diff
===================================================================
--- /dev/null
+++ xerces-c-3.1.4+debian/scripts/sanityTest_ExpectedResult_32.diff
@@ -0,0 +1,15 @@
+--- a/scripts/sanityTest_ExpectedResult.log	2020-12-11 18:29:47.935181377 +0100
++++ a/scripts/sanityTest_ExpectedResult_32.log	2020-12-16 22:15:22.049401596 +0100
+@@ -1202,9 +1202,9 @@
+ 
+   * = Default if not provided explicitly.
+ 
+-At destruction, domBuilderMemMonitor has 276 bytes.
+-At destruction, sax2MemMonitor has 276 bytes.
+-At destruction, sax1MemMonitor has 276 bytes.
++At destruction, domBuilderMemMonitor has 180 bytes.
++At destruction, sax2MemMonitor has 180 bytes.
++At destruction, sax1MemMonitor has 180 bytes.
+ At destruction, staticMemMonitor has 0 bytes.
+ At destruction, domBuilderMemMonitor has 0 bytes.
+ At destruction, sax2MemMonitor has 0 bytes.
Index: xerces-c-3.1.4+debian/Makefile.am
===================================================================
--- xerces-c-3.1.4+debian.orig/Makefile.am
+++ xerces-c-3.1.4+debian/Makefile.am
@@ -30,4 +30,11 @@ pkgconfig_DATA= xerces-c.pc
 check:
 	-rm -f test-results.log
 	export PATH=${abs_top_builddir}/samples:${abs_top_builddir}/tests:"${PATH}" && export XERCESC_NLS_HOME=${abs_top_builddir}/src/.libs && cd ${top_srcdir} && perl scripts/sanityTest.pl 2>&1 | ${SED} 's/ *[0-9][0-9]*  *ms */{timing removed}/' 1> ${abs_top_builddir}/test-results.log
+	if [ "$$(dpkg-architecture -q DEB_HOST_ARCH_BITS)" -eq 32 ]; then \
+	    cp ${top_srcdir}/scripts/sanityTest_ExpectedResult.log ${top_srcdir}/scripts/sanityTest_ExpectedResult_32.log; \
+	    patch -p1 < ${top_srcdir}/scripts/sanityTest_ExpectedResult_32.diff; \
+	fi
 	diff test-results.log ${top_srcdir}/scripts/sanityTest_ExpectedResult.log
+	if [ "$$(dpkg-architecture -q DEB_HOST_ARCH_BITS)" -eq 32 ]; then \
+	    patch -p1 -R < ${top_srcdir}/scripts/sanityTest_ExpectedResult_32.diff; \
+	fi
